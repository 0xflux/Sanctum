<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="style.css">
	<script src="nav.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

	<script>
		document.addEventListener("DOMContentLoaded", function() {
	
			const { invoke } = window.__TAURI__.core;
			const { listen } = window.__TAURI__.event;
	
			const possibleStates = ['Uninstalled', 'Installed', 'Running', 'Stopped', 'ErrorStopped'];
	
			const TIMEOUT_WAIT = 20;
	
	
			//
			// Page initialisation
			//
			// invoke('driver_check_state')
			// 	.then((state) => {
			// 		if (possibleStates.includes(state)) {
			// 			console.log(`Starting state: ${state}`);
			// 			// if (state === 'Scanning') {
			// 			// 	console.log("Starting state is scanning");
			// 			// 	write_live_scan_stats("Scanning...");
			// 			// 	scan_in_progress = true;
			// 			// } else {
			// 			// 	console.log("Starting state is NOT scanning");
			// 			// 	scan_in_progress = false;
			// 			// }
			// 			// set_scan_button_state(scan_in_progress);
			// 		} else {
			// 			console.error(`Unexpected state received: ${state}`);
			// 		}
			// 	})
			// 	.catch((error) => console.error("Invoke error:", error));


			//
			// Events
			//

			document.getElementById("install_driver_btn").addEventListener("click", function(event) {
				event.preventDefault();
				invoke('driver_install_driver')
					.then((response) => {
						print_driver_state(response)
					})
					.catch((error) => {console.error("Invoke error:", error);});
			});

			document.getElementById("uninstall_driver_btn").addEventListener("click", function(event) {
				event.preventDefault();
				invoke('driver_uninstall_driver')
					.then((response) => {
						print_driver_state(response)
					})
					.catch((error) => {console.error("Invoke error:", error);});
			});

			document.getElementById("start_driver_btn").addEventListener("click", function(event) {
				event.preventDefault();
				invoke('driver_start_driver')
					.then((response) => {
						print_driver_state(response)
					})
					.catch((error) => {console.error("Invoke error:", error);});
			});

			document.getElementById("stop_driver_btn").addEventListener("click", function(event) {
				event.preventDefault();

				// document.getElementById("driver_state_msg").textContent = response
				console.log("Stop button clicked");
			});


			//
			// Functions
			//
			function print_driver_state(response) {
				console.log("Hello? ", response)
				const j = JSON.parse(response);
				const [key, value] = Object.entries(j)[0];

				document.getElementById("driver_state_msg").innerText = key;

				if (value) {
					document.getElementById("driver_state_with_err").innerText = value;
				} else {
					document.getElementById("driver_state_with_err").innerText = "";
				}
			}
		});
	</script>

  </head>
  <body>
    <header id="header"><p>Sanctum Home EDR</p></header>

	<div id="container">

		<main id="center" class="column">
			<article>
			
				<h1>Kernel functions</h1>
				<p>A number of functions which relate to functionality in the kernel.</p>

				<div class="full_callout" id="driver_control_panel">
					<b>Primary driver controls</b>
					<p>Use these buttons to control the state of the driver. Current state: <span id="driver_state_msg">Loading...</span><span id="driver_state_with_err" class="error_msg"></span></p>
					<form action="#" id="driver_main_controls">
						<button type="submit" class="single_box_button scan_control_button" id="install_driver_btn">Install</button>
						<button type="submit" class="single_box_button scan_control_button" id="uninstall_driver_btn">Uninstall</button>
						<button type="submit" class="single_box_button scan_control_button" id="start_driver_btn">Start</button>
						<button type="submit" class="single_box_button scan_control_button" id="stop_driver_btn">Stop</button>

					</form>
				</div>
			
			</article>								
		</main>

		<div id="nav-placeholder"></div>

		<div id="right" class="column">
			<p> </p>
		</div>

	</div>

	<!-- <div id="footer-wrapper">
		<footer id="footer"><p>Footer...</p></footer>
	</div> -->
  </body>
</html>